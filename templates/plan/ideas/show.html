{% extends "layout_plan.html" %}
{% block title %}Идея «{{ idea.title }}»{% endblock %}
{% load filters %}
{% block styles %}
{% endblock %}
{% block content %}
<h2 id='title' class="text-muted">{{ idea.title }}</h2>
<p>
    <strong>Предложил</strong> {{ idea.editor }}
</p>
<p>
    {% with idea=idea AUTHOR_TYPE_CHOICES=AUTHOR_TYPE_CHOICES %}
    {% include 'plan/ideas/_authors_list.html' %}
    {% endwith %}
</p>
<div id="description">{{ idea.description_html|safe }}</div>

{% if idea.approved is None %}
{% include 'plan/ideas/_vote.html' %}

{% else %}
<br>

{% if idea.approved == True %}

<p><strong>По результатам голосования идея статьи одобрена!</strong></p>
<div class="card border-success">
    {% if idea.post %}
    <div class="card-header text-white bg-primary">Есть статья!</div>
    <div class="card-body">
        К этой идее создана статья: <a class="btn btn-secondary btn-sm"
            href="{% url 'posts_show' idea.post.id %}">посмотреть</a>
    </div>
    {% else %}
    <div class="card-header text-white bg-success">Сделать из идеи статью</div>
    <div class="card-body text-success">
        <form action="{% url 'posts_create' %}" method="POST" accept-charset="utf-8">
            {% csrf_token %}
            {% include 'plan/posts/_form_base.html' %}
            <input type="hidden" name="idea_id" value="{{ idea.id }}" />
            <button type="submit" class="btn btn-success float-right">Создать статью из идеи!</button>
        </form>
    </div>
    {% endif %}


</div>
{% else %}
<p><strong>По результатам голосования идея статьи отклонена.</strong> Сделать из нее статью на данный момент
    нельзя.</p>
{% endif %}
{% endif %}
<br />

{% with comments=idea.comments_ add_comment_url=idea|url_for_idea_comments form=comment_form %}
{% include 'plan/partials/comments.html' %}
{% endwith %}
{% endblock %}
{% block scripts %}
<script type="text/javascript">
    $('.issues-suggestions .suggestion a').click(function (e) {
        e.preventDefault()
        let id = $(this).data('id')
        
        $('#id_issues').val(id).trigger('change');
    })  
</script>
{% endblock %}